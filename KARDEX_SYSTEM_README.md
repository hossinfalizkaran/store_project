# سیستم کاردکس پیشرفته - راهنمای کامل

## 🎯 **هدف و قابلیت‌ها**

این سیستم یک رابط کاربری پیشرفته برای نمایش کاردکس کالاها با قابلیت‌های مشابه Excel ارائه می‌دهد.

### **قابلیت‌های اصلی:**

1. **مرتب‌سازی پیشرفته**: کلیک روی هر ستون برای مرتب‌سازی
2. **فیلترهای چندگانه**: فیلتر بر اساس تاریخ، نوع عملیات، انبار، شخص و شماره سند
3. **تنظیمات قابل ذخیره**: تمام تنظیمات در localStorage ذخیره می‌شوند
4. **نمایش/مخفی کردن ستون‌ها**: کنترل کامل روی ستون‌های نمایشی
5. **صفحه‌بندی**: تنظیم تعداد رکورد در هر صفحه
6. **تم‌های مختلف**: حالت‌های مختلف نمایش جدول

## 📁 **فایل‌های سیستم**

### **فایل‌های اصلی:**
- `static/js/kardex_manager.js` - مدیریت JavaScript
- `static/js/kardex_settings.json` - تنظیمات پیش‌فرض
- `static/css/kardex_advanced.css` - استایل‌های پیشرفته
- `templates/good_kardex.html` - Template اصلی
- `accounting/views.py` - View به‌روزرسانی شده

### **فایل‌های پشتیبانی:**
- `accounting/templatetags/persian_filters.py` - فیلترهای تاریخ شمسی

## ⚙️ **تنظیمات JSON**

### **ساختار فایل تنظیمات:**

```json
{
  "kardex_display_settings": {
    "default_page_size": 25,
    "available_page_sizes": [10, 25, 50, 100],
    "default_sort_column": "Date",
    "default_sort_direction": "desc",
    "date_range": {
      "start_date": "",
      "end_date": "",
      "preset": "current_month"
    },
    "visible_columns": {
      "Date": true,
      "OperationType": true,
      "DocumentCode": true,
      "PersonName": true,
      "Incoming": true,
      "Outgoing": true,
      "Amount": true,
      "Balance": true
    },
    "column_order": [...],
    "filters": {...},
    "theme": {...}
  }
}
```

## 🔧 **نحوه استفاده**

### **1. دسترسی به کاردکس:**
```
http://localhost:8001/goods/{good_id}/kardex/
```

### **2. پارامترهای URL:**
- `start_date`: تاریخ شروع (YYYY/MM/DD)
- `end_date`: تاریخ پایان (YYYY/MM/DD)
- `page_size`: تعداد رکورد در صفحه
- `sort_column`: ستون مرتب‌سازی
- `sort_direction`: جهت مرتب‌سازی (asc/desc)
- `operation_type`: فیلتر نوع عملیات
- `store`: فیلتر انبار
- `person`: فیلتر شخص
- `document_code`: فیلتر شماره سند

### **3. مثال URL کامل:**
```
http://localhost:8001/goods/674/kardex/?start_date=1404/01/01&end_date=1404/12/29&page_size=25&sort_column=Date&sort_direction=desc&operation_type=5
```

## 🎨 **قابلیت‌های UI**

### **1. فیلترهای پیشرفته:**
- **تاریخ**: انتخاب بازه زمانی با تقویم شمسی
- **محدوده‌های از پیش تعریف شده**: امروز، ماه جاری، سال جاری، ۷ روز قبل، ۳۰ روز قبل
- **نوع عملیات**: فاکتور خرید، فاکتور فروش، برگشت، انتقال
- **انبار**: فیلتر بر اساس انبار
- **شماره سند**: جستجو در شماره‌های سند

### **2. مرتب‌سازی:**
- کلیک روی header هر ستون
- تغییر جهت مرتب‌سازی با کلیک مجدد
- نمایش آیکون جهت مرتب‌سازی

### **3. تنظیمات نمایش:**
- **Modal تنظیمات**: کنترل کامل روی نمایش
- **ستون‌های قابل تنظیم**: نمایش/مخفی کردن هر ستون
- **تم‌های مختلف**: خطوط راه‌راه، hover، نمایش فشرده
- **اندازه صفحه**: ۱۰، ۲۵، ۵۰، ۱۰۰ رکورد

### **4. اطلاعات خلاصه:**
- موجودی اولیه
- کل ورودی
- کل خروجی
- موجودی نهایی

## 💾 **ذخیره تنظیمات**

### **محل ذخیره:**
- **localStorage**: تنظیمات در مرورگر کاربر ذخیره می‌شوند
- **کلید**: `kardex_settings`
- **فرمت**: JSON

### **تنظیمات ذخیره شده:**
- اندازه صفحه
- ستون مرتب‌سازی و جهت
- ستون‌های قابل نمایش
- فیلترهای فعال
- تنظیمات تم

## 🔄 **بازگردانی تنظیمات**

### **هنگام بارگذاری صفحه:**
1. بررسی localStorage برای تنظیمات ذخیره شده
2. اعمال تنظیمات روی جدول
3. بازگردانی فیلترها
4. اعمال تم انتخاب شده

## 📊 **ستون‌های جدول**

### **ستون‌های اصلی:**
1. **تاریخ**: تاریخ تراکنش (شمسی)
2. **نوع عملیات**: فاکتور خرید، فروش، برگشت، انتقال
3. **شماره سند**: شماره سند حسابداری
4. **طرف حساب**: نام شخص یا شرکت
5. **ورودی**: تعداد ورودی (سبز)
6. **خروجی**: تعداد خروجی (قرمز)
7. **قیمت واحد**: قیمت هر واحد
8. **مانده**: موجودی در انتهای تراکنش

## 🎯 **نوع‌های عملیات**

### **کدهای عملیات:**
- `1`: فاکتور خرید
- `2`: برگشت از فروش
- `4`: برگشت از خرید
- `5`: فاکتور فروش
- `11`: انتقال انبار

## 🚀 **نحوه توسعه**

### **اضافه کردن ستون جدید:**
1. اضافه کردن به `visible_columns` در JSON
2. اضافه کردن به `column_order`
3. اضافه کردن checkbox در modal
4. اضافه کردن header در جدول

### **اضافه کردن فیلتر جدید:**
1. اضافه کردن به `filters` در JSON
2. اضافه کردن input در فرم
3. اضافه کردن منطق در view
4. اضافه کردن event listener در JavaScript

## 🔧 **عیب‌یابی**

### **مشکلات رایج:**
1. **تنظیمات ذخیره نمی‌شوند**: بررسی localStorage
2. **مرتب‌سازی کار نمی‌کند**: بررسی data-column در header
3. **فیلترها اعمال نمی‌شوند**: بررسی name attribute در input ها

### **لاگ‌ها:**
- بررسی Console مرورگر برای خطاهای JavaScript
- بررسی Network tab برای درخواست‌های HTTP

## 📈 **بهینه‌سازی**

### **عملکرد:**
- استفاده از pagination برای کاهش بار سرور
- کش کردن تنظیمات در localStorage
- بهینه‌سازی کوئری‌های SQL

### **UX:**
- انیمیشن‌های نرم برای تغییرات
- Loading indicators
- Responsive design

## 🔮 **قابلیت‌های آینده**

### **در دست توسعه:**
1. **Export به Excel**: خروجی فایل Excel
2. **نمودارها**: نمایش گرافیکی روند
3. **فیلترهای پیشرفته**: فیلترهای ترکیبی
4. **جستجوی پیشرفته**: جستجو در متن
5. **Bookmark**: ذخیره فیلترهای پرکاربرد

---

**توسعه‌دهنده**: سیستم حسابداری محک  
**تاریخ**: ۱۴۰۴/۰۵/۱۴  
**نسخه**: ۱.۰.۰ 